{"version":3,"file":"simplemde.js","sources":["../../__gen_lib/src/config.ts","../../__gen_lib/src/component.ts","../../__gen_lib/src/module.ts"],"sourcesContent":["export class SimplemdeConfig {\r\n  /**\r\n   * 风格，默认：`antd`\r\n   */\r\n  style?: 'default' | 'antd' = 'antd';\r\n  /**\r\n   * 延迟初始化\r\n   */\r\n  delay?: number;\r\n  /** 全局 `options` */\r\n  options?: { [key: string]: any };\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  forwardRef,\r\n  ElementRef,\r\n  OnDestroy,\r\n  EventEmitter,\r\n  Output,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  AfterViewInit,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  NgZone,\r\n  ViewChild,\r\n  SimpleChange,\r\n} from '@angular/core';\r\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\r\n\r\nimport { SimplemdeConfig } from './config';\r\n\r\ndeclare const SimpleMDE: any;\r\n\r\n@Component({\r\n  selector: 'simplemde',\r\n  template: `<textarea #con></textarea>`,\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => SimplemdeComponent),\r\n      multi: true,\r\n    },\r\n  ],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class SimplemdeComponent\r\n  implements AfterViewInit, OnChanges, OnDestroy, ControlValueAccessor {\r\n  @ViewChild('con') private con: ElementRef;\r\n  private instance: any;\r\n  private value: string;\r\n\r\n  private onChange: (value: string) => void;\r\n  private onTouched: () => void;\r\n\r\n  @Input() options: any;\r\n  /** 风格，默认：`antd` */\r\n  @Input() style: 'default' | 'antd';\r\n  /** 延迟初始化 */\r\n  @Input() delay: number;\r\n\r\n  constructor(\r\n    private cog: SimplemdeConfig,\r\n    private cd: ChangeDetectorRef,\r\n    private zone: NgZone,\r\n  ) {\r\n    this.style = cog.style;\r\n    this.delay = cog.delay || 0;\r\n  }\r\n\r\n  private initDelay() {\r\n    if (this.delay > 0) {\r\n      setTimeout(() => this.init(), this.delay);\r\n    } else {\r\n      this.init();\r\n    }\r\n  }\r\n\r\n  private init() {\r\n    if (typeof SimpleMDE === 'undefined') {\r\n      throw new Error(`Could not find SimpleMDE object.`);\r\n    }\r\n    this.destroy();\r\n    const config = Object.assign(\r\n      {},\r\n      this.cog,\r\n      this.options,\r\n      this.style === 'antd'\r\n        ? {\r\n            spellChecker: false,\r\n            autoDownloadFontAwesome: false,\r\n          }\r\n        : {},\r\n    );\r\n    config.element = this.con.nativeElement;\r\n    this.zone.runOutsideAngular(() => {\r\n      this.instance = new SimpleMDE(config);\r\n      if (this.value) {\r\n        this.instance.value(this.value);\r\n      }\r\n      this.instance.codemirror.on('change', () => {\r\n        this.value = this.instance.value();\r\n        this.zone.run(() => this.onChange(this.value));\r\n      });\r\n    });\r\n  }\r\n\r\n  private destroy() {\r\n    if (this.instance) {\r\n      this.instance.toTextArea();\r\n      this.instance = null;\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.initDelay();\r\n  }\r\n\r\n  ngOnChanges(\r\n    changes: { [P in keyof this]?: SimpleChange } & SimpleChanges,\r\n  ): void {\r\n    if (!changes.options.firstChange) this.initDelay();\r\n  }\r\n\r\n  /**\r\n   * 获取UE实例\r\n   *\r\n   * @readonly\r\n   */\r\n  get Instance(): any {\r\n    return this.instance;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.destroy();\r\n  }\r\n\r\n  // reuse-tab: http://ng-alain.com/components/reuse-tab#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\r\n  _onReuseInit() {\r\n    this.initDelay();\r\n  }\r\n\r\n  writeValue(value: string): void {\r\n    this.value = value;\r\n    if (this.instance) {\r\n      this.instance.value(this.value);\r\n    }\r\n  }\r\n\r\n  registerOnChange(fn: (_: any) => {}): void {\r\n    this.onChange = fn;\r\n  }\r\n  registerOnTouched(fn: () => {}): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {}\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule, ModuleWithProviders } from '@angular/core';\r\n\r\nimport { SimplemdeComponent } from './component';\r\nimport { SimplemdeConfig } from './config';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  declarations: [SimplemdeComponent],\r\n  exports: [SimplemdeComponent],\r\n})\r\nexport class SimplemdeModule {\r\n  static forRoot(config?: SimplemdeConfig): ModuleWithProviders {\r\n    return {\r\n      ngModule: SimplemdeModule,\r\n      providers: [{ provide: SimplemdeConfig, useValue: config }],\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;qBAI+B,MAAM;;CAOpC;;;;;;ACXD;;;;;;IAmDE,YACU,KACA,IACA;QAFA,QAAG,GAAH,GAAG;QACH,OAAE,GAAF,EAAE;QACF,SAAI,GAAJ,IAAI;QAEZ,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;QACvB,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC;KAC7B;;;;IAEO,SAAS;QACf,IAAI,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE;YAClB,UAAU,CAAC,MAAM,IAAI,CAAC,IAAI,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;SAC3C;aAAM;YACL,IAAI,CAAC,IAAI,EAAE,CAAC;SACb;;;;;IAGK,IAAI;QACV,IAAI,OAAO,SAAS,KAAK,WAAW,EAAE;YACpC,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;SACrD;QACD,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,uBAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAC1B,EAAE,EACF,IAAI,CAAC,GAAG,EACR,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,KAAK,KAAK,MAAM;cACjB;gBACE,YAAY,EAAE,KAAK;gBACnB,uBAAuB,EAAE,KAAK;aAC/B;cACD,EAAE,CACP,CAAC;QACF,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC;QACxC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;YAC1B,IAAI,CAAC,QAAQ,GAAG,IAAI,SAAS,CAAC,MAAM,CAAC,CAAC;YACtC,IAAI,IAAI,CAAC,KAAK,EAAE;gBACd,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACjC;YACD,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE,CAAC,QAAQ,EAAE;gBACpC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;gBACnC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;aAChD,CAAC,CAAC;SACJ,CAAC,CAAC;;;;;IAGG,OAAO;QACb,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;YAC3B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;SACtB;;;;;IAGH,eAAe;QACb,IAAI,CAAC,SAAS,EAAE,CAAC;KAClB;;;;;IAED,WAAW,CACT,OAA6D;QAE7D,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,WAAW;YAAE,IAAI,CAAC,SAAS,EAAE,CAAC;KACpD;;;;;;;IAOD,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,QAAQ,CAAC;KACtB;;;;IAED,WAAW;QACT,IAAI,CAAC,OAAO,EAAE,CAAC;KAChB;;;;IAGD,YAAY;QACV,IAAI,CAAC,SAAS,EAAE,CAAC;KAClB;;;;;IAED,UAAU,CAAC,KAAa;QACtB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACjC;KACF;;;;;IAED,gBAAgB,CAAC,EAAkB;QACjC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;KACpB;;;;;IACD,iBAAiB,CAAC,EAAY;QAC5B,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;KACrB;;;;;IAED,gBAAgB,CAAC,UAAmB,KAAU;;;YA1H/C,SAAS,SAAC;gBACT,QAAQ,EAAE,WAAW;gBACrB,QAAQ,EAAE,4BAA4B;gBACtC,SAAS,EAAE;oBACT;wBACE,OAAO,EAAE,iBAAiB;wBAC1B,WAAW,EAAE,UAAU,CAAC,MAAM,kBAAkB,CAAC;wBACjD,KAAK,EAAE,IAAI;qBACZ;iBACF;gBACD,eAAe,EAAE,uBAAuB,CAAC,MAAM;aAChD;;;;YAfQ,eAAe;YAVtB,iBAAiB;YAIjB,MAAM;;;oBAwBL,SAAS,SAAC,KAAK;wBAOf,KAAK;sBAEL,KAAK;sBAEL,KAAK;;;;;;;ACjDR;;;;;IAYE,OAAO,OAAO,CAAC,MAAwB;QACrC,OAAO;YACL,QAAQ,EAAE,eAAe;YACzB,SAAS,EAAE,CAAC,EAAE,OAAO,EAAE,eAAe,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC;SAC5D,CAAC;KACH;;;YAXF,QAAQ,SAAC;gBACR,OAAO,EAAE,CAAC,YAAY,CAAC;gBACvB,YAAY,EAAE,CAAC,kBAAkB,CAAC;gBAClC,OAAO,EAAE,CAAC,kBAAkB,CAAC;aAC9B;;;;;;;;;;;;;;;;;;"}