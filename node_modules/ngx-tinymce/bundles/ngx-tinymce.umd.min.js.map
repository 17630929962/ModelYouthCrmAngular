{"version":3,"sources":["ng://ngx-tinymce/src/tinymce.options.ts","ng://ngx-tinymce/src/tinymce.script.service.ts","ng://ngx-tinymce/src/tinymce.component.ts","ng://ngx-tinymce/src/tinymce.module.ts"],"names":["TinymceOptions","this","baseURL","fileName","ScriptService","doc","loaded","list","emitter","Subject","prototype","getChangeEmitter","load","path","_this","promises","forEach","script","push","loadScript","Promise","all","then","res","next","resolve","reject","node","createElement","type","src","charset","readyState","onreadystatechange","status","onload","onerror","error","getElementsByTagName","appendChild","Injectable","Inject","args","DOCUMENT","TinymceComponent","defConfig","ss","cd","zone","inited","id","Math","random","toString","substring","_disabled","delay","Object","defineProperty","value","setDisabled","TemplateRef","_loadingTpl","_loading","initDelay","setTimeout","init","window","tinymce","Error","_a","config","instance","url","endsWith","substr","length","userOptions","assign","options","selector","setup","editor","on","getContent","run","onChange","init_instance_callback","setContent","auto_focus","detectChanges","destroy","off","remove","setMode","ngOnInit","ngAfterViewInit","subscribe","ngOnChanges","changes","ngOnDestroy","_onReuseInit","writeValue","registerOnChange","fn","registerOnTouched","onTouched","setDisabledState","isDisabled","disabled","Component","template","preserveWhitespaces","providers","provide","NG_VALUE_ACCESSOR","useExisting","forwardRef","multi","changeDetection","ChangeDetectionStrategy","OnPush","ChangeDetectorRef","NgZone","Input","NgxTinymceModule","forRoot","ngModule","useValue","NgModule","imports","CommonModule","declarations","exports"],"mappings":"6ZAAA,SAAAA,IAEEC,KAAAC,QAAY,oBAEZD,KAAAE,SAAa,+BCMb,SAAAC,EAAsCC,GAAAJ,KAAAI,IAAAA,EAJ9BJ,KAAAK,QAAS,EACTL,KAAAM,KAAY,GACZN,KAAAO,QAA4B,IAAIC,EAAAA,QA4E1C,OAxEEL,EAAAM,UAAAC,iBAAA,WACE,OAAOV,KAAKO,SAGdJ,EAAAM,UAAAE,KAAA,SAAKC,GAAL,IAAAC,EAAAb,KACE,GAAIA,KAAKK,OACP,OAAOL,KAGTA,KAAKK,QAAS,EAEd,IAAMS,EAA2B,GAQjC,MANA,CAACF,GAAMG,QAAQ,SAAAC,GAAU,OAAAF,EAASG,KAAKJ,EAAKK,WAAWF,MAEvDG,QAAQC,IAAIN,GAAUO,KAAK,SAAAC,GACzBT,EAAKN,QAAQgB,MAAK,KAGbvB,MAGTG,EAAAM,UAAAS,WAAA,SAAWN,GAAX,IAAAC,EAAAb,KACE,OAAO,IAAImB,QAAQ,SAACK,EAASC,GAC3B,IAAwB,IAApBZ,EAAKP,KAAKM,GAAd,CASAC,EAAKP,KAAKM,IAAQ,EAElB,IAAMc,EAAOb,EAAKT,IAAIuB,cAAc,UACpCD,EAAKE,KAAO,kBACZF,EAAKG,IAAMjB,EACXc,EAAKI,QAAU,QACLJ,EAAMK,WAERL,EAAMM,mBAAqB,WAEF,WAArBN,EAAMK,YACe,aAArBL,EAAMK,aAENL,EAAMM,mBAAqB,KACjCR,EAAa,CACXZ,KAAMA,EACNP,QAAQ,EACR4B,OAAQ,aAKdP,EAAKQ,OAAS,WACZV,EAAa,CACXZ,KAAMA,EACNP,QAAQ,EACR4B,OAAQ,YAIdP,EAAKS,QAAU,SAACC,GACd,OAAAZ,EAAa,CACXZ,KAAMA,EACNP,QAAQ,EACR4B,OAAQ,YAEZpB,EAAKT,IAAIiC,qBAAqB,QAAQ,GAAGC,YAAYZ,QA5CnDF,EAAa,CACXZ,KAAMA,EACNP,QAAQ,EACR4B,OAAQ,kCApCjBM,EAAAA,kFAMcC,EAAAA,OAAMC,KAAA,CAACC,EAAAA,eA0EtBvC,kBCJE,SAAAwC,EACUC,EACAC,EACAC,EACAC,GAHA/C,KAAA4C,UAAAA,EACA5C,KAAA6C,GAAAA,EACA7C,KAAA8C,GAAAA,EACA9C,KAAA+C,KAAAA,EAlCF/C,KAAAgD,QAAS,EACjBhD,KAAAW,MAAO,EACPX,KAAAiD,GAAK,YAAYC,KAAKC,SACnBC,SAAS,IACTC,UAAU,GAYLrD,KAAAsD,WAAY,EAYpBtD,KAAAuD,MAAQ,EAyIV,OA1JEC,OAAAC,eACId,EAAAlC,UAAA,WAAQ,KADZ,SACaiD,GACX1D,KAAKsD,UAAYI,EACjB1D,KAAK2D,+CAMPH,OAAAC,eACId,EAAAlC,UAAA,UAAO,KADX,SACYiD,GACNA,aAAiBE,EAAAA,YAAa5D,KAAK6D,YAAcH,EAChD1D,KAAK8D,SAAWJ,mCAcff,EAAAlC,UAAAsD,UAAR,WAAA,IAAAlD,EAAAb,KACmB,EAAbA,KAAKuD,MACPS,WAAW,WAAM,OAAAnD,EAAKoD,QAAQjE,KAAKuD,OAEnCvD,KAAKiE,QAIDtB,EAAAlC,UAAAwD,KAAR,WAAA,IAAApD,EAAAb,KACE,IAAKkE,OAAOC,QAAS,MAAM,IAAIC,MAAM,oBAE/B,IAAAC,EAAArE,KAAE4C,EAAAyB,EAAAzB,UAAW0B,EAAAD,EAAAC,OAAQrB,EAAAoB,EAAApB,GAC3B,IAAIjD,KAAKuE,SAAT,CAEA,GAAI3B,EAAU3C,QAAS,CACrB,IAAIuE,EAAM,GAAK5B,EAAU3C,QACrBuE,EAAIC,SAAS,OAAMD,EAAMA,EAAIE,OAAO,EAAGF,EAAIG,OAAS,IACxDR,QAAQlE,QAAUuE,EAGpB,IAAMI,EAAcpB,OAAOqB,OAAO,GAAIjC,EAAU0B,OAAQA,GAElDQ,EAAUtB,OAAOqB,OACrB,CACEE,SAAU,IAAM9B,GAElBL,EAAU0B,OACVA,EACA,CACEU,MAAO,SAACC,IACNpE,EAAK0D,SAAWU,GACTC,GAAG,eAAgB,WACxBrE,EAAK6C,MAAQuB,EAAOE,aACpBtE,EAAKkC,KAAKqC,IAAI,WAAM,OAAAvE,EAAKwE,SAASxE,EAAK6C,WAER,mBAAtBkB,EAAYI,OACrBJ,EAAYI,MAAMC,IAGtBK,uBAAwB,SAACL,GACnBA,GAAUpE,EAAK6C,OAAOuB,EAAOM,WAAW1E,EAAK6C,OACjD7C,EAAK8C,cAC6C,mBAAvCiB,EAAYU,wBACrBV,EAAYU,uBAAuBL,MAKvCL,EAAYY,aACdV,EAAQU,WAAavC,GAGvBkB,QAAQF,KAAKa,GAEb9E,KAAKW,MAAO,EACZX,KAAK8C,GAAG2C,kBAGF9C,EAAAlC,UAAAiF,QAAR,WACO1F,KAAKuE,WAGVvE,KAAKuE,SAASoB,MACd3F,KAAKuE,SAASqB,OAAO,IAAM5F,KAAKiD,IAChCjD,KAAKuE,SAAW,OAGV5B,EAAAlC,UAAAkD,YAAR,WACO3D,KAAKuE,UACVvE,KAAKuE,SAASsB,QAAQ7F,KAAKsD,UAAY,WAAa,WAGtDX,EAAAlC,UAAAqF,SAAA,WACE9F,KAAKgD,QAAS,GAGhBL,EAAAlC,UAAAsF,gBAAA,WAAA,IAAAlF,EAAAb,KAEE,GAAIkE,OAAOC,QACTnE,KAAK+D,gBADP,CAKQ,IAAAnB,EAAA5C,KAAA4C,UACF3C,EAAU2C,GAAaA,EAAU3C,QACjCC,EAAW0C,GAAaA,EAAU1C,SACxCF,KAAK6C,GACFlC,MAAMV,GAAW,sBAAwBC,GAAY,mBACrDQ,mBACAsF,UAAU,WAAM,OAAAnF,EAAKkD,gBAG1BpB,EAAAlC,UAAAwF,YAAA,SAAYC,GACNlG,KAAKgD,QAAUkD,EAAQ5B,SACzBtE,KAAK0F,UACL1F,KAAK+D,cAITpB,EAAAlC,UAAA0F,YAAA,WACEnG,KAAK0F,WAIP/C,EAAAlC,UAAA2F,aAAA,WACEpG,KAAK0F,UACL1F,KAAK+D,aAGPpB,EAAAlC,UAAA4F,WAAA,SAAW3C,GAET1D,KAAK0D,MAAQA,GAAS,GAClB1D,KAAKuE,UACPvE,KAAKuE,SAASgB,WAAWvF,KAAK0D,QAIlCf,EAAAlC,UAAA6F,iBAAA,SAAiBC,GACfvG,KAAKqF,SAAWkB,GAElB5D,EAAAlC,UAAA+F,kBAAA,SAAkBD,GAChBvG,KAAKyG,UAAYF,GAGnB5D,EAAAlC,UAAAiG,iBAAA,SAAiBC,GACf3G,KAAK4G,SAAWD,EAChB3G,KAAK2D,mCAhMRkD,EAAAA,UAASpE,KAAA,CAAC,CACTsC,SAAU,UACV+B,SAAU,uMAMVC,qBAAqB,EAQrBC,UAAW,CACT,CACEC,QAASC,EAAAA,kBACTC,YAAaC,EAAAA,WAAW,WAAM,OAAAzE,IAC9B0E,OAAO,IAGXC,gBAAiBC,EAAAA,wBAAwBC,eAbvC,yHAfKzH,SADAI,SANPsH,EAAAA,yBAGAC,EAAAA,0CA+CCC,EAAAA,wBAEAA,EAAAA,uBASAA,EAAAA,qBAOAA,EAAAA,SA0IHhF,kBChNA,SAAAiF,KAeA,OATSA,EAAAC,QAAP,SAAe/C,GACb,MAAO,CACLgD,SAAUF,EACVZ,UAAW,CACT7G,EACA,CAAE8G,QAASlH,EAAgBgI,SAAUjD,0BAX5CkD,EAAAA,SAAQvF,KAAA,CAAC,CACRwF,QAAS,CAACC,EAAAA,cACVC,aAAc,CAACxF,GACfyF,QAAS,CAACzF,OAYZiF","sourcesContent":["export class TinymceOptions {\r\n  /** æå®tinymceç®å½è·¯å¾ï¼é»è®¤ï¼`./assets/tinymce/` */\r\n  baseURL ? = './assets/tinymce/';\r\n  /** æå®tinymceæä»¶åï¼é»è®¤ï¼`tinymce.min.js` */\r\n  fileName ? = 'tinymce.min.js';\r\n  /** é»è®¤éç½®é¡¹ï¼å¯¹å¨å± Tinymce ææ */\r\n  config?: any;\r\n  /** å»¶è¿å è½½ï¼åä½ï¼æ¯«ç§ï¼ï¼é»è®¤ï¼`0` */\r\n  delay?: number;\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { Subject } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class ScriptService {\r\n  private loaded = false;\r\n  private list: any = {};\r\n  private emitter: Subject<boolean> = new Subject<boolean>();\r\n\r\n  constructor(@Inject(DOCUMENT) private doc: any) {}\r\n\r\n  getChangeEmitter() {\r\n    return this.emitter;\r\n  }\r\n\r\n  load(path: string) {\r\n    if (this.loaded) {\r\n      return this;\r\n    }\r\n\r\n    this.loaded = true;\r\n\r\n    const promises: Promise<any>[] = [];\r\n\r\n    [path].forEach(script => promises.push(this.loadScript(script)));\r\n\r\n    Promise.all(promises).then(res => {\r\n      this.emitter.next(true);\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  loadScript(path: string): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      if (this.list[path] === true) {\r\n        resolve(<any>{\r\n          path: path,\r\n          loaded: true,\r\n          status: 'Loaded',\r\n        });\r\n        return;\r\n      }\r\n\r\n      this.list[path] = true;\r\n\r\n      const node = this.doc.createElement('script');\r\n      node.type = 'text/javascript';\r\n      node.src = path;\r\n      node.charset = 'utf-8';\r\n      if ((<any>node).readyState) {\r\n        // IE\r\n        (<any>node).onreadystatechange = () => {\r\n          if (\r\n            (<any>node).readyState === 'loaded' ||\r\n            (<any>node).readyState === 'complete'\r\n          ) {\r\n            (<any>node).onreadystatechange = null;\r\n            resolve(<any>{\r\n              path: path,\r\n              loaded: true,\r\n              status: 'Loaded',\r\n            });\r\n          }\r\n        };\r\n      } else {\r\n        node.onload = () => {\r\n          resolve(<any>{\r\n            path: path,\r\n            loaded: true,\r\n            status: 'Loaded',\r\n          });\r\n        };\r\n      }\r\n      node.onerror = (error: any) =>\r\n        resolve(<any>{\r\n          path: path,\r\n          loaded: false,\r\n          status: 'Loaded',\r\n        });\r\n      this.doc.getElementsByTagName('head')[0].appendChild(node);\r\n    });\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  forwardRef,\r\n  OnChanges,\r\n  OnDestroy,\r\n  Input,\r\n  OnInit,\r\n  AfterViewInit,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  TemplateRef,\r\n  SimpleChanges,\r\n  NgZone,\r\n} from '@angular/core';\r\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\r\nimport { ScriptService } from './tinymce.script.service';\r\nimport { TinymceOptions } from './tinymce.options';\r\n\r\ndeclare const window: any;\r\ndeclare const tinymce: any;\r\n\r\n@Component({\r\n  selector: 'tinymce',\r\n  template: `\r\n  <textarea id=\"{{id}}\" class=\"tinymce-selector\"></textarea>\r\n  <div class=\"loading\" *ngIf=\"load\">\r\n    <ng-container *ngIf=\"_loading; else _loadingTpl\">{{_loading}}</ng-container>\r\n  </div>\r\n  `,\r\n  preserveWhitespaces: false,\r\n  styles: [\r\n    `\r\n      :host .tinymce-selector {\r\n        display: none;\r\n      }\r\n    `,\r\n  ],\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => TinymceComponent),\r\n      multi: true,\r\n    },\r\n  ],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class TinymceComponent\r\n  implements OnInit, AfterViewInit, OnChanges, OnDestroy, ControlValueAccessor {\r\n  private instance: any;\r\n  private value: string;\r\n  private inited = false;\r\n  load = true;\r\n  id = `_tinymce-${Math.random()\r\n    .toString(36)\r\n    .substring(2)}`;\r\n\r\n  private onChange: (value: string) => void;\r\n  private onTouched: () => void;\r\n\r\n  @Input()\r\n  config: any;\r\n  @Input()\r\n  set disabled(value: boolean) {\r\n    this._disabled = value;\r\n    this.setDisabled();\r\n  }\r\n  private _disabled = false;\r\n\r\n  _loading: string;\r\n  _loadingTpl: TemplateRef<any>;\r\n  @Input()\r\n  set loading(value: string | TemplateRef<any>) {\r\n    if (value instanceof TemplateRef) this._loadingTpl = value;\r\n    else this._loading = value;\r\n  }\r\n\r\n  /** å»¶è¿åå§å */\r\n  @Input()\r\n  delay = 0;\r\n\r\n  constructor(\r\n    private defConfig: TinymceOptions,\r\n    private ss: ScriptService,\r\n    private cd: ChangeDetectorRef,\r\n    private zone: NgZone,\r\n  ) {}\r\n\r\n  private initDelay() {\r\n    if (this.delay > 0) {\r\n      setTimeout(() => this.init(), this.delay);\r\n    } else {\r\n      this.init();\r\n    }\r\n  }\r\n\r\n  private init() {\r\n    if (!window.tinymce) throw new Error('tinymce jsæä»¶å è½½å¤±è´¥');\r\n\r\n    const { defConfig, config, id } = this;\r\n    if (this.instance) return;\r\n\r\n    if (defConfig.baseURL) {\r\n      let url = '' + defConfig.baseURL;\r\n      if (url.endsWith('/')) url = url.substr(0, url.length - 1);\r\n      tinymce.baseURL = url;\r\n    }\r\n\r\n    const userOptions = Object.assign({}, defConfig.config, config);\r\n\r\n    const options = Object.assign(\r\n      {\r\n        selector: `#` + id,\r\n      },\r\n      defConfig.config,\r\n      config,\r\n      {\r\n        setup: (editor: any) => {\r\n          this.instance = editor;\r\n          editor.on('change keyup', () => {\r\n            this.value = editor.getContent();\r\n            this.zone.run(() => this.onChange(this.value));\r\n          });\r\n          if (typeof userOptions.setup === 'function') {\r\n            userOptions.setup(editor);\r\n          }\r\n        },\r\n        init_instance_callback: (editor: any) => {\r\n          if (editor && this.value) editor.setContent(this.value);\r\n          this.setDisabled();\r\n          if (typeof userOptions.init_instance_callback === 'function') {\r\n            userOptions.init_instance_callback(editor);\r\n          }\r\n        },\r\n      },\r\n    );\r\n    if (userOptions.auto_focus) {\r\n      options.auto_focus = id;\r\n    }\r\n\r\n    tinymce.init(options);\r\n\r\n    this.load = false;\r\n    this.cd.detectChanges();\r\n  }\r\n\r\n  private destroy() {\r\n    if (!this.instance) {\r\n      return;\r\n    }\r\n    this.instance.off();\r\n    this.instance.remove('#' + this.id);\r\n    this.instance = null;\r\n  }\r\n\r\n  private setDisabled() {\r\n    if (!this.instance) return;\r\n    this.instance.setMode(this._disabled ? 'readonly' : 'design');\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.inited = true;\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    // å·²ç»å­å¨å¯¹è±¡æ é¡»è¿å¥æå è½½æ¨¡å¼\r\n    if (window.tinymce) {\r\n      this.initDelay();\r\n      return;\r\n    }\r\n\r\n    const { defConfig } = this;\r\n    const baseURL = defConfig && defConfig.baseURL;\r\n    const fileName = defConfig && defConfig.fileName;\r\n    this.ss\r\n      .load((baseURL || './assets/tinymce/') + (fileName || 'tinymce.min.js'))\r\n      .getChangeEmitter()\r\n      .subscribe(() => this.initDelay());\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    if (this.inited && changes.config) {\r\n      this.destroy();\r\n      this.initDelay();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroy();\r\n  }\r\n\r\n  // reuse-tab: http://ng-alain.com/components/reuse-tab#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\r\n  _onReuseInit() {\r\n    this.destroy();\r\n    this.initDelay();\r\n  }\r\n\r\n  writeValue(value: string): void {\r\n    // value should be NOT NULL\r\n    this.value = value || '';\r\n    if (this.instance) {\r\n      this.instance.setContent(this.value);\r\n    }\r\n  }\r\n\r\n  registerOnChange(fn: (_: any) => {}): void {\r\n    this.onChange = fn;\r\n  }\r\n  registerOnTouched(fn: () => {}): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this.disabled = isDisabled;\r\n    this.setDisabled();\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { TinymceOptions } from './tinymce.options';\r\nimport { TinymceComponent } from './tinymce.component';\r\nimport { ScriptService } from './tinymce.script.service';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  declarations: [TinymceComponent],\r\n  exports: [TinymceComponent],\r\n})\r\nexport class NgxTinymceModule {\r\n  static forRoot(options: TinymceOptions): ModuleWithProviders {\r\n    return {\r\n      ngModule: NgxTinymceModule,\r\n      providers: [\r\n        ScriptService,\r\n        { provide: TinymceOptions, useValue: options },\r\n      ],\r\n    };\r\n  }\r\n}\r\n"]}